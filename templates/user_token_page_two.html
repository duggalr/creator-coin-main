{% extends 'base.html' %}
{% load static %}


{% block content %}

  {% include 'navbar.html' %}

   
  <div class="animate__animated animate__fadeIn main-body">

    <div class="container">

      <div class="row"> 

        <div class="col-4">
          
          {% if user_nft_obj is not None %}
             
            <!-- <div>

              <h4 style="display: inline;" style="padding-top: 10px; font-weight: 900;">
                {{ user_nft_obj.nft_name }}
              </h4>
              | 
              <span style="font-weight: 900;">
                Updated: {{ user_nft_obj.nft_updated_at|date:"Y-m-d" }}
              </span>

            </div> -->
 
            {% if user_three_dim_upload is False %}

              <img src="{{ user_nft_obj.nft_media_file.url }}" width="280px" style="border-radius: 5%; box-shadow: 5px 5px #F5F5F5; " >

            {% else %}

              <model-viewer 
                src="{{ user_nft_obj.nft_media_file.url }}"
                ar ar-modes="webxr scene-viewer quick-look" 
                camera-controls
                camera-orbit="250deg 85deg 125%"
                shadow-intensity="1"
                auto-rotate
                rotation-per-second="250%"
                style="width: 340px; height: 340px;" 
                ></model-viewer>

            {% endif %}

            

            <!-- <br/> -->
 
            <!-- <button class="btn btn-outline-success rounded-pill" style="font-size: 17px;">
              Launch your NFT
            </button> -->

            <div style="padding-top: 14px;">

              <p style="display: inline; font-weight: 400; font-size: 22px; ">
                {{ user_nft_obj.nft_name }}
              </p>

              {% if same_user is True %}

                <span style="font-size: 19px;">
                  | <strong>Price:</strong> {{ user_nft_obj.nft_price }} ETH
                  <!-- |
                  <i class="bi bi-trash-fill" style="color: red;"></i> 
                  <a href="{% url 'delete_non_minted_nft' %}" onclick="return confirm('Are you SURE you want to delete your NFT? (you can create another one...)');">
                  <strong>Delete NFT</strong>
                  </a> -->

                </span>

                <!-- <button class="btn btn-primary rounded-pill" id="launch-nft">
                  Launch your NFT
                </button> -->

                <!-- <a href="{% url 'mint_new_nft_token' profile_id=profile_id %}">Launch your NFT</a>
                &nbsp;
                <a href="{% url 'update_token_form' %}">Edit Token Settings</a> -->
                  
              {% endif %}

              <div style="padding-top: 3px;"></div>


            </div>

            <!-- <br/><br/> -->
            <!-- <a href="">Launch your Token!</a> -->
            
            <div style="padding-top: 10px;">

              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" aria-label="Example with label" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                  0%
                </div>
              </div>

            </div>

            <p style="font-size: 18px;">

              <!-- <strong>Price:</strong> {{ user_nft_obj.nft_price }} ETH
              | -->

              {% if user_nft_obj.nft_deployed is False %}
                <strong style="color: gray;">Total Sold: 0</strong>
              {% else %}
                <strong>Total Sold:</strong> 0 
              {% endif %}

              |
              <strong>Total Supply:</strong> {{ user_nft_obj.nft_total_supply }} 
            
            </p>

            <!-- <a href="{% url 'mint_new_nft_token' profile_id=profile_id %}">Launch your NFT</a> -->

            <!-- <button class="btn btn-primary rounded-pill" id="launch-nft-button">Launch your NFT</button>
              &nbsp;
            <a href="{% url 'update_token_form' %}">Edit NFT Metadata</a> -->

            <!-- <a href="{% url 'update_token_form' %}">Delete NFT</a> -->

          {% else %}

            <model-viewer 
            src="{% static '3d_model/placeholder_new.glb' %}"  
            ar ar-modes="webxr scene-viewer quick-look" 
            camera-orbit="250deg 85deg 125%"
            camera-controls
            shadow-intensity="1"
            auto-rotate
            rotation-per-second="400%"
            style="width: 350px; height: 350px;"
            ></model-viewer>

            
          {% endif %}
    


          {% if same_user is True %}

             {% if user_nft_obj is not None %}

              {% if user_nft_obj.nft_deployed is True %}

                <!-- <button class="btn btn-primary rounded-pill" id="delete-nft-button">
                  Cancel NFT  Sale
                </button> -->

                <!-- <button id="delete-nft-button" type="button" class="btn btn-outline-danger" style="font-size: 16px;">
                  Cancel NFT  Sale
                </button> -->

                <button id="buy-nft-buttton" type="button" class="btn btn-primary " style="font-size: 19px;">Buy NFT</button>
                

              {% else %}

                <i class="bi bi-pen-fill"></i>
                <a href="{% url 'update_token_form' %}">Edit NFT Metadata</a>
                <!-- &nbsp; -->
                |
                <i class="bi bi-trash-fill" style="color: red;"></i> 
                <a href="{% url 'delete_non_minted_nft' %}" onclick="return confirm('Are you SURE you want to delete your NFT? (you can create another one...)');">
                  <strong>Delete NFT</strong>
                </a>

                <!-- <button class="btn btn-primary rounded-pill" id="launch-nft-button" style="font-size: 18px;">Launch your NFT</button>
                &nbsp; -->

              {% endif %}
              
                 
            {% else %}

              <span class="badge rounded-pill text-bg-secondary" style="font-size: 15px;">
                No active NFT sale. Maybe you should launch one?
              </span>

            {% endif %}

          {% else %}
            
            {% if user_nft_obj is not None %}
              
              <button id="buy-nft-buttton" type="button" class="btn btn-primary " style="font-size: 19px;">Buy NFT</button>

            {% else %}

              <span class="badge rounded-pill text-bg-secondary" style="font-size: 15px;">
                User does not have a NFT for sale at the moment.
              </span>

            {% endif %}

          {% endif %}


        </div>
        

        <!-- TODO: delete afterwards and add in approriate spot -->
        <!-- what if user clicks this and isn't logged in? -->
        <!-- <button id="buy-nft">Buy NFT</button> -->
         

        <div class="col-8" id="project-text-main">

          <div class="project-header">

            {% if creator_profile.creator_name is not None and creator_profile.creator_name != '' %}
              <h2 class="project-title">
                {{ creator_profile.creator_name }}
              </h2>
              
              {% if creator_profile.creator_email is not None and creator_profile.creator_email != '' %}
                <span style="font-size: 18px;">
                  | {{ creator_profile.creator_email }}
                </span>
              {% endif %}

            {% else %}
              {% if same_user is True %}
                <h2 class="project-title">
                  Add a name/username?
                </h2>
              {% else %}
                <h2 class="project-title">
                  No Name
                </h2>
              {% endif %}
            {% endif %}
            
            
            <!-- TODO: for same user, just display edit here; also display purchase, they should be able to purchase there own -->
            <!-- <div style="margin-left: auto;">              
              <button type="button" id="project-fund-button" class="btn btn-outline-info rounded-pill">Purchase</button>
              &nbsp;
              <a href='#'>Edit Page</a>
            </div> -->

            <!-- <div style="margin-left: auto;">
            </div> -->


            <div style="margin-left: auto;">  
              
              {% if same_user is True %}

                <a href="{% url 'edit_user_profile' profile_id=profile_id %}" class="btn btn-outline-dark rounded-pill" role="button" style="font-size: 16.5px;"> 
                  Edit Profile
                </a>
                
                {% if user_nft_obj is not None %}

                  {% if user_nft_obj.nft_deployed is False %}
                    
                    <button class="btn btn-info btn-lg rounded-pill" id="launch-nft-button" style="font-size: 18px; color: white;">Launch your NFT</button>

                  {% else %}

                    <button id="delete-nft-button" type="button" class="btn btn-outline-danger rounded-pill" style="font-size: 16px;">
                      Cancel NFT  Sale
                    </button>

                  {% endif %}

                {% else %}

                  <button id="user_create_nft" class="btn btn-outline-info rounded-pill" style="font-size: 17px;">
                    Create your NFT
                  </button>

                {% endif %}                


              {% else %}

                <!-- <span class="badge rounded-pill text-bg-info" style="font-size: 14px;">
                  No active token sale at the moment
                </span> -->
              
              {% endif %}

            </div>

          </div>
          
          <p class="project-user-pk-address">
            <i class="bi bi-key-fill"></i> {{ creator_profile.user_obj.user_pk_address }}
          </p>


          <div class="project-subheading-information">
            
            {% if github_profile is not None %}
                
              <span>
                <i class="bi bi-github"></i> <a href="{{ github_profile.github_profile_url }}" target="_blank" rel="noopener noreferrer">Github</a>
                <i style="color: skyblue;" class="bi bi-check-circle-fill" data-bs-toggle="tooltip" data-bs-placement="top" title="Github Verified by User."></i>
              </span>

            {% else %}

              <!-- <span style="padding-left: 12px;">
                <i class="bi bi-link"></i> <a href="">
                  add a personal website
                </a>
              </span> -->

              {% if same_user is True %}

                <span>
                  <i class="bi bi-github"></i> 
                  <a href="{% url 'github_login' %}" >
                    add your github
                  </a>
                </span>
              
              {% else %}

                <span>
                  <i class="bi bi-github"></i>
                  User did not link his github.
                </span>

              {% endif %}


            {% endif %}


            {% if creator_profile.creator_personal_website|length > 0 and creator_profile.creator_personal_website is not None %}

              <span style="padding-left: 12px;">
                <i class="bi bi-link"></i> <a href="{{ creator_profile.creator_personal_website }}" target="_blank" rel="noopener noreferrer">
                  Personal Website
                </a>
              </span>

            {% else %}

              {% if same_user is True %}
                
                <span style="padding-left: 12px;">
                  <i class="bi bi-link"></i> <a href="{% url 'edit_user_profile' profile_id=profile_id %}">
                    add your personal website
                  </a>
                </span>

              {% endif %}

            {% endif %}


            {% if creator_profile.creator_discord_website|length > 0 and creator_profile.creator_discord_website is not None %}

              <span style="padding-left: 12px;">
                <i class="bi bi-discord"></i> 
                <a href="{{ creator_profile.creator_discord_website }}" target="_blank" rel="noopener noreferrer">
                  Discord
                </a>
              </span>  

            {% else %}

              {% if same_user is True %}
 
                <span style="padding-left: 12px;">
                  <i class="bi bi-discord"></i> 
                  <a href="{% url 'edit_user_profile' profile_id=profile_id %}">
                    add your discord
                  </a>
                </span> 

              {% endif %}

            {% endif %}

            
          </div>

          <div class="project-desc">  

            <p style="font-size: 17px;">

              {% if creator_profile.creator_description is not None and creator_profile.creator_description != '' %}
                {{ creator_profile.creator_description }}
              {% else %}

                {% if same_user is True %}
                  <b>Add a brief description for the project(s) you are currently working on.</b>
                  You can always provide further details and updates in the project log, below.
                  <br/>
                  
                {% else %}
                  <b>The creator did not seem to create a description.</b>
                {% endif %}

              {% endif %}
                
            </p>

          </div>

          
        </div>


      </div>


      <br/>

      {% include 'project_page_navbar.html' %}



    </div>

  </div>



  <!-- Nft Verification Modal: when user doesn't complete all their profile information -->
  <div class="modal" tabindex="-1" id="nftVerificationModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"> &#129488; Couple steps remaining </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>
            Before creating a NFT, you must <b>complete</b> the following 2 steps:
            <ul>
              <li>Add your name by going to <a href="{% url 'edit_user_profile' profile_id=profile_id %}">edit profile.</a> Add a nice description while your at it!</li>
              <li>
                <b>
                  Add and verify your github.
                </b>
              </li> 
            </ul>
            &#127882; <b>I know your excited</b>, and based on historical data, the above steps should only take you ~30 seconds to complete. 
          </p>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div>

  <br/>


  <!-- <div id="overlay">
    <div class="w-100 d-flex justify-content-center align-items-center">
      <div id="spinning_border" class="spinner-border" role="status" style="display: none;">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div> -->

  <div id="overlay" style="display: none;">
    <div id="overlay-text">
      <div id="spinning_border" class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <!-- <strong>Loading...</strong> -->
      &nbsp; Your NFT is getting ready for takeoff... &#128640;
    </div>
  </div>

  
  
  <br/>

 
  <script>

    const csrfToken = '{{ csrf_token }}';
    const mainContractAddress = '{{ user_nft_obj.nft_deployed_contract_address }}'
    const creatorProfileID = '{{ creator_profile.id }}'


    // const nftVerificationModal = new bootstrap.Modal('#nftVerificationModal')

    // $( "#user_create_nft" ).click(function() {
      
    //   // Verify profile details
    //   $.ajax({
    //     url: "{% url 'verify_user_profile' %}",
    //     success: function (response) {
    //       console.log('res:', response);
          
    //       if (response['success'] === false){

    //         nftVerificationModal.show();

    //       } else if (response['success'] === true){

    //         window.location.href = 'http://127.0.0.1:7500/create-nft'

    //       }

    //     }

    //   })

      
    // });


    // $( "#launch-nft" ).click(function() {

    //   window.location.href = ''

    // })


    // function off(){
    //   document.getElementById("overlay").style.display = "none";
    // }

    // function on(){
    //   document.getElementById("overlay").style.display = "block";
    // }
    

  </script>



{% endblock %}  








